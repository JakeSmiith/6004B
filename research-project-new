cd "C:\Users\jakes\Downloads"
tempfile daily mon quart
import excel using "VIX_historical.xlsx", sheet("Daily") firstrow clear
gen date = observation_date
format date %tdNN/DD/CCYY
gen freq = "daily"
drop observation_date
rename VIXCLS  vix
rename T10Y2Y  t10y2y
rename T10YIE  t10yie
rename WTI     wti
rename BC      brent
save `daily', replace]
list date brent in 1/15
save `daily', replace

import excel using "VIX_historical.xlsx", sheet("Monthly") firstrow clear
list date WHEAT in 1/15
rename TB3S    tbill3m
rename HHNG    natgas
rename CORN    corn
rename WHEAT   wheat
rename SOYBEAN soybean
gen date = observation_date
format date %tdNN/DD/CCYY
tsset date, daily
tsfill
ipolate tbill3m   date, gen(tb3m_d)
ipolate natgas    date, gen(natgas_d)
ipolate corn      date, gen(corn_d)
ipolate wheat     date, gen(wheat_d)
ipolate soybean   date, gen(soybean_d)
list date tb3m_d natgas_d corn_d wheat_d soybean_d if inrange(date, td(01jan1990), td(15jan1990)), clean noobs
save `mon', replace

import excel using "VIX_historical.xlsx", sheet("Quarterly") firstrow clear
gen date = observation_date
format date %tdNN/DD/CCYY
tsset date, daily
tsfill
ipolate gdp date, gen(gdp_d)
list date gdp gdp_d if inrange(date, td(01jan1990), td(15jan1990)), clean noobs
save `quart', replace

clear
use `daily'
merge 1:1 date using "`mon'"
drop _merge
merge 1:1 date using "`quart'"
save vix_all_frequencies.dta, replace

list date gdp_d wheat_d in 1/15

use vix_all_frequencies.dta, clear
encode freq, gen(panel)
xtset panel date
xtdescribe

xtile decile = vix, nq(10)
gen crisis10 = decile == 10
label define cris_lbl2 0 "Normal" 1 "Crisis"
label values crisis10 cris_lbl2

quietly sum vix, detail
local p90 = r(p90)
histogram vix, bin(50) normal xline(`p90', lcolor(red) lpattern(dash)) title("VIX Distribution with Top-Decile Cutoff") xtitle("VIX Level") ytitle("Frequency") note("Red line marks the minimum VIX value in the top decile (`=string(`p90',"%9.2f")')")
save vix_all_frequencies.dta, replace

foreach x in wti brent natgas corn_d wheat_d soybean_d {
    gen r_`x' = 100*(ln(`x') - ln(L.`x'))
}
drop if _n==1
summ r_wti r_brent r_natgas r_corn_d r_wheat_d r_soybean_d, detail

import delimited "C:\Users\jakes\Downloads\sp500.csv", varnames(1) clear
rename date date_str
gen date = date(date_str, "DMY")
format date %tdNN/DD/CCYY
list date_str adjusted_close in 1/15
drop date_str
keep date adjusted_close
rename adjusted_close sp_adjclose
save "sp_returns.dta", replace

use vix_all_frequencies.dta, clear
drop _merge
merge 1:1 date using "sp_returns.dta"
drop if _merge==1
drop _merge


